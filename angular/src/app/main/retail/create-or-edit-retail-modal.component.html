<div bsModal #createOrEditModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
    aria-labelledby="createOrEditModal" aria-hidden="true" [config]="{backdrop: 'static'}">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form #editForm="ngForm" novalidate (ngSubmit)="save()">
                <div class="modal-header">
                    <h4 class="modal-title">
                        <span *ngIf="retail.id">Cập nhật retail : {{retail.id}}</span>
                        <span *ngIf="!retail.id">Tạo mới retail</span>
                    </h4>
                    <button type="button" class="close" (click)="close()" [attr.aria-label]="l('Close')">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                        <div class="form-group">
                        <label>{{l("Retail code")}} *</label>
                        <input #id="ngModel" class="form-control" type="text" name="id"
                                [(ngModel)]="retail.code" required maxlength="64">
                        <validation-messages [formCtrl]="id"></validation-messages>
                    </div>
                    <div class="form-group">
                        <label>Mã hàng hóa *</label>
                        <select #merchIDInput="ngModel" class="form-control" [(ngModel)]="retail.merchandiseID" name="merchID" required>
                            <option *ngFor="let item of merchandises" [value]="item.id">{{item.name}}</option>
                        </select>
                        <validation-messages [formCtrl]="merchIDInput"></validation-messages>
                    </div>
                    <div class="form-group">
                        <label>Mã nhà cung cấp *</label>
                        <select #vendorIDInput="ngModel" class="form-control" [(ngModel)]="retail.vendorID" name="vendorID" required>
                            <option *ngFor="let item of vendors" [value]="item.id">{{item.name}}</option>
                        </select>
                        <validation-messages [formCtrl]="vendorIDInput"></validation-messages>
                    </div>
                    <div class="form-group">
                        <label>{{l("Quantity")}} *</label>
                        <input #quantity="ngModel" class="form-control" type="text" name="Quantity"
                                [(ngModel)]="retail.quantity" required maxlength="64">
                        <validation-messages [formCtrl]="quantity"></validation-messages>
                    </div>
                    <div class="form-group">
                        <label>{{l("Price")}} *</label>
                        <input #price="ngModel" class="form-control" type="text" name="Price"
                                [(ngModel)]="retail.price" required maxlength="64">
                        <validation-messages [formCtrl]="price"></validation-messages>
                    </div>
                    <div class="form-group">
                        <label>{{l("BoughtQuantity")}} *</label>
                        <input #boughtquantity="ngModel" class="form-control" type="text" name="Boughtquantity"
                                [(ngModel)]="retail.boughtQuantity" required maxlength="64">
                        <validation-messages [formCtrl]="boughtquantity"></validation-messages>
                    </div>
                    <nav class="navbar navbar-expand-sm navbar-light margin-top-15" style="background-color: #e3f2fd;">
                        <h4 class="modal-title" style="width: 95%;">
                            <i class="fa fa-table"></i>
                            <span> Chi tiết thanh toán</span>
                        </h4>
                        <div class="col-xs-6" style="margin-right: 10px; float: right;">
                            <button [disabled]="saving" type="button" (click)="addContractPayment()"
                                *ngIf="('Pages.Administration.ContractPayment.Create')"
                                class="btn m-btn m-btn--hover-accent m-btn--icon m-btn--icon-only m-btn--pill">
                                <i class="fa fa-plus"></i>
                            </button>
                        </div>
                    </nav>
                    <div class="custom-table">
                            <table>
                                <thead>
                                    <th style="width: 5%; text-align: center;">
                                        <span >
                                            Đợt
                                        </span>
                                    </th>
                                    <th style="width: 25%; text-align: center;">
                                        <span >
                                            Ngày dự kiến thanh toán
                                        </span>
                                    </th>
                                    <th style="width: 10%; text-align: center;">
                                        <span >
                                            %
                                        </span>
                                    </th>
                                    <th style="width: 20%; text-align: center;">
                                        <span >
                                            Số tiền thanh toán
                                        </span>
                                    </th>
                                    <th style="width: 40%; text-align: center;">
                                        <span >
                                            Diễn giải
                                        </span>
                                    </th>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let item of listPayment">
                                        <td>
                                            <span>{{item.batch}}</span>
                                        </td>
                                        <td>
                                            <input type="date" class="form-control" value={{item.paymentDate}} (change)="item.paymentDate = $event.target.value">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control" value="{{item.percent}}" min="0" max="100" 
                                                (change)="item.percent = $event.target.value" onkeypress="return event.charCode >= 48;">
                                        </td>
                                        <td>
                                            <span>{{item.percent * retail.price / 100}}</span>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control" value="{{item.note}}" (change)="item.note = $event.target.value">
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <!-- <div class="has-danger" *ngIf="totalPercent(listPayment)" style="margin-top: 5px">
                                <label>Tổng % của chi tiết thanh toán không được quá 100%</label>
                            </div> -->
                        </div>
                </div>
                <div class="modal-footer">
                    <button [disabled]="saving" type="button" class="btn btn-default" (click)="close()">{{l("Cancel")}}</button>
                    <button type="submit" class="btn btn-primary" [buttonBusy]="saving" [busyText]="l('SavingWithThreeDot')">
                        <i class="fa fa-save"></i>
                        <span>{{l("Save")}}</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
