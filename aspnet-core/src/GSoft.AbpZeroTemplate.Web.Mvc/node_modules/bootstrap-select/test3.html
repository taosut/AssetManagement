<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" href="dist/css/bootstrap-select.css">

  <style>
  .scroll {
    position: relative;
    overflow: hidden;
  }

  /* .inner-inner, */
  /* .bootstrap-select.btn-group .dropdown-menu.inner.inner-inner {
    position: absolute;
    top: 0;
    margin: 0;
    list-style: none;
  } */

  .bootstrap-select.btn-group .dropdown-menu.inner.list-container {
    position: absolute;
    top: 0;
  }

  .xxinner-inner {
      position: absolute;
      top: 100%;
      left: 0;
      z-index: 1000;
      /* display: none; */
      float: left;
      min-width: 160px;
      /* padding: 5px 0; */
      /* margin: 2px 0 0; */
      font-size: 14px;
      text-align: left;
      list-style: none;
      background-color: #fff;
      -webkit-background-clip: padding-box;
      background-clip: padding-box;
      /* border: 1px solid #ccc;
      border: 1px solid rgba(0,0,0,.15);
      border-radius: 4px; */
      /* -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
      box-shadow: 0 6px 12px rgba(0,0,0,.175); */

      display: block;
      border: none;
      border-radius: 0;
      -webkit-box-shadow: none;
      box-shadow: none;
      width: 100%;
      padding: 0;
      margin: 0;
  }

  .xxinner-inner>li>a {
    display: block;
    padding: 3px 20px;
    clear: both;
    font-weight: 400;
    line-height: 1.42857143;
    color: #333;
    white-space: nowrap;
    cursor: pointer;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }

  .xxinner-inner>li>a:focus, .xxinner-inner>li>a:hover {
      color: #262626;
      text-decoration: none;
      background-color: #f5f5f5;
  }
  </style>

</head>

<body>
<button type="button" id="scrollToBottom">Scroll 1</button>
<button type="button" id="scrollToBottom2">Scroll 2</button>
<div class="bs-container btn-group bootstrap-select show-tick open" style="transform: translateZ(0); top: 80px; left: 5px; width: 200px;">
  <div class="dropdown-menu open" role="combobox" style="max-height: 749px; overflow: hidden; min-height: 134px; min-width: 200px;">
    <div class="bs-searchbox"><input type="text" class="form-control" autocomplete="off" role="textbox" aria-label="Search"></div>
    <div class="scroller1 dropdown-menu inner open" style="max-height: 480px; overflow-y: auto; min-height: 80px;">
      <div class="dropdown-menu inner open inner-container" style="position: relative; top: 0;"><ul class="list-container dropdown-menu inner open"></ul></div>
    </div>
  </div>
</div>

<!-- <div class="bs-container btn-group bootstrap-select show-tick open" style="transform: translateZ(0); top: 80px; left: 5px; width: 200px;">
  <div class="dropdown-menu open" role="combobox" style="max-height: 749px; overflow: hidden; min-height: 134px; min-width: 200px;">
    <div class="bs-searchbox"><input type="text" class="form-control" autocomplete="off" role="textbox" aria-label="Search"></div>

      <div class="scroller1" style="height: 480px; overflow-y: scroll;">
        <div class="inner-container" style="position: relative; width: 100%;"><ul class="inner-inner" style="width: 183px; top: 50px;"></ul></div>
      </div>

  </div>
</div> -->

<div class="bs-container btn-group bootstrap-select show-tick open" style="top: 80px; left: 215px; width: 200px;">
  <div class="dropdown-menu open" role="combobox" style="max-height: 749px; overflow: hidden; min-height: 134px; min-width: 200px;">
    <div class="scroll open">
      <div class="bs-searchbox"><input type="text" class="form-control" autocomplete="off" role="textbox" aria-label="Search"></div>
      <div class="scroll" style="width: 200px;">
        <div class="scroller2" style="height: 480px; overflow-y: scroll;">
          <div class="inner-container" style="position: relative; width: 100%; height: 52000px;"><ul class="inner-inner inner2" style="width: 183px;"></ul></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="bs-container btn-group bootstrap-select show-tick open" style="transform: translate3d(0, 0, 0); top: 80px; left: 430px; width: 200px;">
   <div class="dropdown-menu open" role="combobox" style="max-height: 749px; overflow: hidden; min-height: 134px; min-width: 200px;">
      <div class="bs-searchbox"><input type="text" class="form-control" autocomplete="off" role="textbox" aria-label="Search"></div>
      <div class="dropdown-menu inner open" style="max-height: 695px; overflow-y: auto; min-height: 80px;">
        <ul class="dropdown-menu inner open" role="listbox" aria-expanded="true">
           <li data-original-index="1"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 0</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="2"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 1</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="3"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 2</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="4"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 3</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="5"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 4</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="6"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 5</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="7"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 6</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="8"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 7</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="9"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 8</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="10"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 9</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="11"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 10</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="12"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 11</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="13"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 12</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="14"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 13</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="15"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 14</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="16"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 15</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="17"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 16</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="18"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 17</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="19"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 18</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="20"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 19</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="21"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 20</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="22"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 21</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="23"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 22</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="24"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 23</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="25"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 24</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="26"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 25</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
           <li data-original-index="27"><a tabindex="0" class="" data-tokens="null" role="option"><span class="text">Option 26</span><span class="glyphicon glyphicon-ok check-mark"></span></a></li>
        </ul>
      </div>
   </div>
</div>

<select></select>
<select multiple></select>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://rawgit.com/wilsonpage/fastdom/master/fastdom.js"></script>
<!-- <script src="https://rawgit.com/wilsonpage/fastdom/master/fastdom-strict.js"></script> -->

<script type="text/javascript">

var numberOfOptions = 2000,
    inner = document.querySelector('.inner-container'),
    scroller1 = document.querySelector('.scroller1'),
    scroller2 = document.querySelector('.scroller2'),
    visibleOptions = [],
    options = [],
    position0,
    position1;

var frag = document.createDocumentFragment();

for (var i = 0; i < numberOfOptions; i++) {
  var div = document.createElement('div');
  div.innerHTML = '<li data-original-index="' + i + '"><a>Option ' + i + '</a></li>';
  options[i] = div.firstChild;
  frag.appendChild(options[i]);
}

//$('.inner2')[0].appendChild(frag);
var li = document.createElement('li');

li.innerHTML = '<a>Woo</a>';

var a = inner.firstChild.appendChild(li);

var height = 26;//a.offsetHeight;

inner.firstChild.removeChild(li);

scroll(0, true);

function scroll(scrollTop, init) {
  var position = Math.floor(scrollTop / height),
      size = numberOfOptions,
      rows = Math.ceil(480 / height),
      prevPositions = [position0, position1];
  position0 = Math.max(0, Math.min(size - rows, position));
  position1 = position0 + rows;

  position0 = Math.max(0, position0 - 1);
  position1 = Math.min(size, position1 + 1);

  var diff = position1 - position0;
  var top = position0 * height;
  var bottom = (size - position1) * height;
  var temp = inner.offsetHeight;
  if (init || prevPositions[0] !== position0 || prevPositions[1] !== position1) {
    this.currentOptions = options.slice(position0, position1);
    if (init) {
      var fragment = document.createDocumentFragment();
      for (var i = 0; i < diff; i++) {
        visibleOptions[i] = this.currentOptions[i].cloneNode(true);
        fragment.appendChild(visibleOptions[i]);
      }
      //fastdom.mutate(function() {
        inner.firstChild.appendChild(fragment);
      //});
        var innerHeight = top + bottom + inner.firstChild.offsetHeight;

        inner.style.height = innerHeight + 'px';
    } else {
      var newInner = inner.firstChild.cloneNode(false);
      inner.replaceChild(newInner, inner.firstChild);
      //inner.innerHTML = '';
      //fastdom.mutate(function() {
        //for (var i = 0; i < diff; i++) {
          //visibleOptions[i].replaceChild(this.currentOptions[i].firstChild.cloneNode(true), visibleOptions[i].firstChild);
          //visibleOptions[i].innerHTML = this.currentOptions[i].innerHTML;
        //}
      //});
      var fragment = document.createDocumentFragment();
      for (var i = 0; i < diff; i++) {
        visibleOptions[i] = this.currentOptions[i].cloneNode(true);
        fragment.appendChild(visibleOptions[i]);
      }
      //fastdom.mutate(function() {
        inner.firstChild.appendChild(fragment);
      //});
    }

    //inner.firstChild.style.top = (/*top - */Math.max(0, scrollTop - 5 * 26)) + 'px';
    //inner.firstChild.style.top = (top - scrollTop) + 'px';
    inner.firstChild.style.top = top + 'px';



    //updateScroll = false;

    //fastdom.mutate(function() {
      //inner.style.marginTop = top + 'px';
      //inner.style.marginBottom = bottom + 'px';
    //});

    //console.log(inner.offsetHeight);
    //scroller.scrollTo = scrollTop;
    //setTimeout(function() {
      //scroller.scrollTop = scrollTop;
    //});
  }
}

/*scroller1.addEventListener('scroll', function(e) {
  console.log('scroll!')
  var that = this;
  //fastdom.measure(function() {
  var scrollTop = that.scrollTop;
    scroll(scrollTop);
  //});
});*/

var updateScroll = true;

$(scroller1).off('scroll.update').on('scroll.update', function() {
  var that = this;
  scroll(that.scrollTop);
});

/*$(scroller1).scroll(function() {
  //scroll(this.scrollTop);
  $(this).scrollTop(this.scrollTop);
  updateScroll = true;
});*/

$(scroller2).off('scroll').on('scroll', function() {
  //scroll(this.scrollTop);
  $('.scroller1').scrollTop(this.scrollTop);
});

// select the target node
/*var target = inner;
 
// create an observer instance
var observer = new MutationObserver(function(mutations) {
  mutations.forEach(function(mutation) {
    //console.log(mutation.type);
    //scroll(scroller.scrollTop);
  });    
});
 
// configuration of the observer:
var config = { attributes: true, childList: true, characterData: true };
 
// pass in the target node, as well as the observer options
observer.observe(target, config);*/

document.getElementById('scrollToBottom').addEventListener('click', function() {
  scroller1.scrollTop = scroller1.scrollHeight;
});

document.getElementById('scrollToBottom2').addEventListener('click', function() {
  scroller2.scrollTop = scroller2.scrollHeight;
});

setTimeout(function() {
  //$('.scroller1').scrollTop(500);
  //$('.scroller2').scrollTop(1500);
});

</script>

</body>

</html>